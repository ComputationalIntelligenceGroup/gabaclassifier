# ---
# output:
#   md_document:
#     variant: markdown_github
# ---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# Issues
- **apply theta_complement? maybe it could change the results a lot!!** does it just apply to torque?
- **Maybe also include the training functions here, also the trainig dataset, with the list of used cells.**
- Poner detalles sobre el modelo y su accuracy   

# Overview 

`gabaclassifier` classifies a given neuronal morphology into one of eight types (see below), such as Chandelier or Martinotti. 

For example, it classifies cell C030502A as a nest basket cell.

```{r, message=FALSE}
library(gabaclassifier) 
file <- system.file('extdata', 'C030502A.swc', package = 'gabaclassifier')
classify_interneuron(file = file, layer  = '23')
``` 

The output is short code for the type name. The codes for the eight types are: 
```{r, echo=FALSE}
knitr::kable(data.frame(short = get_type_codes(), long = get_type_names())  )
```  

# Installing  

`gabaclassifier` requires `neurostr` and `neurostrplus` to be installed. The following installs all three packages (install the `devtools` package with `install.package('devtools')` if you don't have it):
```{r, eval = FALSE}
# install.package('devtools')
devtools::install_github("neurostr")
devtools::install_github("neurostrplus")
devtools::install_github("gabaclassifier") 
```   
These packages have only been tested on Ubuntu 16.04.    

# Usage
Cells are classified with the `classify_interneuron` function. The inputs are

- A path to a SWC reconstruction of a neuron morphology 
- The layer containing the cell's soma 

The path must be fully expanded, that is `/home/user/neuron.swc` while work while `~/neuron.swc` will not. 

The model has been trained with layer L2/3 to layer L6 interneurons and thus only interneurons from those layers are allowed as input to `classify_interneuron`.  
```{r} 
classify_interneuron(file = file, layer  = '1')
```
 
Also, `gabaclassifier` will only classify morphology reconstruction that pass the following quality checks:

- has axon and dendrites, 
- attached to soma, 
- length > 3000 and so on. 

A cell will be classified as long as it   1. Passes basics morphology quality such as  

`gabaclassifier` will classify any neuronal recontruction that passes the above criteria () , assigning it into one of the mentioned classes. Since it was trained with  male rat ... somatosensory cortex (see below), passing other species, area etc. interneurons may result in poorer prediction.  
  
# Model  
The classification is based on a model trained in a supervised fashion. Namely the underlying model is a random forest with X trees and  The model is random forest (**citation**) trained on **650** hind-limb somatosensory cortex interneurons from two-week-old male Wistar rats reconcsturcted by the Markam laboratory (**cite**). The ids of the cells are provided in ... while laminar metadata is available in ... The cells came from layers L2/3, L4, L5, or L6 cell and fullfilled morphology quality criteria listed above. 

The 10-fold cross-validated accuracy of the model is XX%. The best predicted types are ChC, .. while types such as BTC and abv are herder to detec: **Show the confusion matrix.**  
